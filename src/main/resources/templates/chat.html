<!DOCTYPE html>
<html lang="ro" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Asistent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon Image -->
    <link rel="icon" type="image/png" th:href="@{/images/assets/favicon.svg}"/>

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Libraries Stylesheet -->
    <link rel="stylesheet" th:href="@{/css/assistant.css}">
</head>

<body>
<!-- Navbar Start -->
<nav class="navbar">
    <h3 class="navbar__logo">Asistentul tău AI pentru cumpărături sustenabile</h3>
</nav>
<!-- Navbar End -->

<!-- Header Start: afișează doar dacă nu există produse -->
<header class="header" th:if="${allChats == null or #lists.isEmpty(allChats)}">
    <div class="header__title">
        <h1>Bună !</h1>
        <h2>Cu ce te pot ajuta astăzi ?</h2>
    </div>
    <div class="suggests">
        <div class="suggests__item">
            <p class="suggests__item-text">
                Care e scopul platformei TooGoodToWaste ?
            </p>
            <div class="suggests__item-icon">
                <i class='bx bx-leaf'></i>
            </div>
        </div>
        <div class="suggests__item">
            <p class="suggests__item-text">
                Cum ajută această platformă la reducerea risipei alimentare ?
            </p>
            <div class="suggests__item-icon">
                <i class='bx bx-upload'></i>
            </div>
        </div>
        <div class="suggests__item">
            <p class="suggests__item-text">
                Care sunt produsele disponibile cu reducere de 60% ?
            </p>
            <div class="suggests__item-icon">
                <i class='bx bx-box'></i>
            </div>
        </div>
        <div class="suggests__item">
            <p class="suggests__item-text">
                Ce produse îmi recomanzi să cumpăr astăzi pentru a evita risipa ?
            </p>
            <div class="suggests__item-icon">
                <i class='bx bx-store-alt'></i>
            </div>
        </div>
    </div>
</header>
<!-- Header End -->

<section class="chats">
    <!-- Iterăm peste toate mesajele din model -->
    <div th:each="msg : ${allChats}">
        <!-- Mesajul trimis de user -->
        <div class="message message--outgoing">
            <div class="message__content">
                <img class="message__avatar"  th:src="@{/images/assets/user.png}" alt="User avatar" />
                <p class="message__text" th:text="${msg.prompt}"></p>
            </div>
        </div>

        <!-- Mesajul venit de la AI -->
        <div class="message message--incoming">
            <div class="message__content">
                <img class="message__avatar" th:src="@{/images/assets/waste.svg}" alt="Terra avatar" />
                <p class="message__text" th:text="${msg.message}"></p>

                <div class="message__loading-indicator hide">
                    <div class="message__loading-bar"></div>
                    <div class="message__loading-bar"></div>
                    <div class="message__loading-bar"></div>
                </div>
            </div>
            <span onClick="copyMessageToClipboard(this)" class="message__icon">
                <i class='bx bx-copy-alt'></i>
            </span>
        </div>
    </div>
</section>


<!-- Input Prompt Start -->
<!-- Input Prompt Start -->
<section class="prompt">
    <form method="post" id="chatForm" class="prompt__form" novalidate>
        <!-- Hidden input for logged-in user -->
        <input type="hidden" id="currentUserId" th:value="${user != null ? user.id : ''}" />

        <div class="prompt__input-wrapper">
            <input type="text" name="message" placeholder="Scrie întrebarea ta aici" class="prompt__form-input" required>
            <button class="prompt__form-button" id="sendButton" type="submit">
                <i class='bx bx-send'></i>
            </button>
        </div>
    </form>

    <form th:action="@{/chat/delete}" method="post" id="deleteChatForm">
        <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
        <button type="submit" class="prompt__form-button" id="deleteButton" style="margin-right: 335px; margin-top: -23px;">
            <i class='bx bx-trash pulse-js'></i>
        </button>
    </form>

    <p class="prompt__disclaim">
        Răspunsurile pot să nu fie întotdeauna pe deplin corecte sau actualizate, te rugăm să verifici informațiile importante.
    </p>
</section>
<!-- Input Prompt End -->
<!-- JavaScript Libraries -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="/js/chat.js"></script>
</body>

</html>